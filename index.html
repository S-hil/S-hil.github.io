<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Welcome to my World">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Welcome to my World">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Welcome to my World">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Welcome to my World</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Welcome to my World</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about-me">
          <a href="/About-Me" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            About Me
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/08/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/08/undefined  tle/" itemprop="url">Punctuating Japanese Transcripts using MeCAB Tokenizer and BiLSTM-CRF</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-08T00:21:07+09:00">
                2019-11-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Punctuating passages is a difficult task for Neural Network. The task gets even more challenging when it is a spoken transcript in a language like Japanese. Unlike English, There is no space between words for Japanese.<br>To oversimplify the task these are the 3 main steps required foe this task. I got the best results using BiLSTM CRF model.  </p>
<ol>
<li><p>We first need to tokenize the words using a Tokenizer.</p>
</li>
<li><p>Then design the Input Sequence with relevant context.</p>
</li>
<li><p>Do some feature Engineering and make the prediction.</p>
</li>
</ol>
<p><img src="/asset/abcde.png" alt="Punctuation"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/18/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/18/undefined  tle/" itemprop="url">Deploying keras Model to Production on Google Cloud</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-06-18T16:23:10+09:00">
                2019-06-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Deploying a model to production is an important skill that a Machine Learning Engineer should add to his skillset. I trained a MNIST model and created a writing interface. User can draw a digit using the interface and the model would predict the digit.<br><img src="/asset/abcd.png" alt="App Running"></p>
<p>I made an app.yaml file and tried deploying it on Google Cloud using Google Cloud SDK. After successful deployment, there was a server error when using the command <code>gcloud app browse</code>(maybe due to error in the app.yaml)<br><img src="/asset/abc.png" alt="Server Error"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/02/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/02/undefined  tle/" itemprop="url">I trained an AI to generate r/bitcoin post titles, and it said: I am mining in the future</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-02T15:56:09+09:00">
                2019-01-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Since I was getting bored in my holidays, I figured it might be funny to train an AI on the r/bitcoin subreddit post titles and the results are amazing.</p>
<p>Some highlights:</p>
<blockquote>
<p>When you ‘ re not holding your keys ; you are in the us government  </p>
<p>I’ve been surviving off ramen the past few days ago .  </p>
<p>Bitcoin cash will not take over bitcoin .  </p>
<p>Hey, coinbase and other people to buy bitcoin .  </p>
<p>How i feel great ! i ‘ m fast being priced out of it  </p>
<p>Bitcoin is a tool for freeing humanity from oligarchs and tyrants , dressed up as a first time ever - bbc news  </p>
<p>I just bought my first bitcoin investment has finally doubled ! ! ! ! ! ! ! ! !  </p>
<p>I ‘ m a low level bitcoiner . . . .  </p>
<p>Bitcoin is a “ firmware problem “  </p>
<p>We are now being sold for bitcoin  </p>
<p>I ‘ m a ucla student who started a blog explaining to millennials why bitcoin is a good idea  </p>
<p>Bitcoin is going to eat my dick if wrong .  </p>
<p>I ‘ m not going down !  </p>
<p>Owning 1 bitcoin = 3 ounce of gold ! if they should rebrand to anti - bitcoin will be able to pay my waiter his tip in btc  </p>
<p>i am a proud son .  </p>
<p>A reminder why bitcoin is going to be a part in my mind . . . . .  </p>
<p>We are now actively contributing code and communicated on the bitcoin network .  </p>
<p>I am finally in the us senate want to sell bitcoins  </p>
<p>Bitcoin is still an extremely risky and speculative investment.  </p>
<p>Can we please activate segwit faster .  </p>
<p>Bitcoin is at $ 3000 all time high , everyone is acting like their dog just died .  </p>
<p>What if the bank runs out of the latest , and whom i ‘ m upgraded to be shitting himself so hard about bitcoin  </p>
<p>Welcome to the bitcoin vs stocks vs gold vs silver  </p>
<p>Reminder : hard fork  </p>
<p>20 mining bashing on unlimited way to ukraine  </p>
<p>Former fed employee fined for installing bitcoin mining  </p>
<p>A shilling to time we got here in japan  </p>
<p>This scam is unacceptable . Let’s getting out of that’s to this subreddit whenever bitcoin is signalling  </p>
<p>Secure , stable and efficient smart contracts  </p>
<p>Don ‘ t believe , these numbers aren’t fuck more than 200 crypto atms in united states vs coinbase inc.  </p>
<p>Bitcoin is a shitcoin.  </p>
<p>Woke up after 4 - years of people need to worry about ?  </p>
<p>Iran just officially stopped accepting dollars for oil payments .  </p>
<p>Wow , andreas is intelligent .  </p>
<p>Bitcoin core dev will support segwit . maybe next time  </p>
<p>Good news - the fighting phase has started painting bitcoin art themes , i hey yesterday , be honest .  </p>
<p>Hence bitcoin is now signalling segwit  </p>
<p>I just lost one third of my whole day of work function  </p>
<p>Biggest venezuelan exchange announces its banking situation is resolved , fiat transactions  </p>
<p>Breadwallet becomes bread , a tad bit drunk and just laughing my ass off  </p>
<p>Spent this afternoon creating a generation of people that write the code by accident  </p>
<p>Yesterday was my birthday and i think my neighbour is a big deal  </p>
<p>Up 800 % this year # btc ? lol  </p>
<p>Sessions : trump directed law enforcement and regulatory agencies  </p>
<p>The pump has never been more obvious , and we wouldn’t give a student some good investing advice - bitcoinity usd $ 11 , 000  </p>
<p>Segwit locked in the philippines !  </p>
<p>Bitpay just did this ?  </p>
<p>Thank you.  </p>
<p>The b2x developer does not cut it anymore .  </p>
<p>Bitcoin is a good idea</p>
</blockquote>
<p>Dumps:</p>
<p>I will upload the Dumps soon</p>
<p>AI seems to like Bitcoin and hate US government.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/28/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/28/undefined  tle/" itemprop="url">Landmark Retrieval</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-28T16:53:53+09:00">
                2018-11-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Landmark Retrieval Model.</p>
<p>Result after training.<br><img src="/asset/ab.png" alt="Sample Image Added via Markdown"></p>
<p>Jupyter Notebook link is written below<br><em>It is not interactive</em></p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-Landmark-Retrieval-Model"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-Landmark-Retrieval-Model" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the Landmark Retrieval Model"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/Landmark%20Retrievel.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the Landmark Retrieval Model</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/19/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/19/undefined  tle/" itemprop="url">Classic Fashion-MNIST Dataset</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-19T14:28:35+09:00">
                2018-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>The original MNIST dataset contains a lot of handwritten digits. Members of the AI/ML/Data Science community love this dataset and use it as a benchmark to validate their algorithms. In fact, MNIST is often the first dataset researchers try. “If it doesn’t work on MNIST, it won’t work at all”, they said. “Well, if it does work on MNIST, it may still fail on others.”</p>
<p><strong>To Serious Machine Learning Researchers</strong></p>
<ol>
<li><p>MNIST is too easy.</p>
</li>
<li><p>MNIST is overused.</p>
</li>
<li><p>MNIST can not represent modern CV tasks.</p>
</li>
</ol>
<p>MNIST Dataset contains 60000 images of 10 different classes.<br>I was able to get an accuracy of 91.2 % on this Dataset.<br><em>It is not interactive</em></p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-Fashion-mnist-Classification-Model"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-Fashion-mnist-Classification-Model" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the Fashion-mnist Classification Model"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/fashionmnistsaved.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the Fashion-mnist Classification Model</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/28/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/28/undefined  tle/" itemprop="url">Supervised Learning on very Large Dataset</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-28T15:31:41+09:00">
                2018-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Supervised Learning is unarguable one of the most important use-case for Machine Learning. And yet its important is not recognised by most researchers. Supervised Learning makes up a large fraction of the work done by AI companies. Being Proficient in Supervised learning would really help the company satisfy their client faster and enable them to earn more profit.</p>
<p>In this task, I worked on Rossmann Dataset. Rossmann Dataset consists of data of all German Supermarket. The task is to predict sales for next 2 weeks. Click below for the Jupyter Notebook Link.<br><em>It is not interactive</em></p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-Rossmann-Dataset-Model"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-Rossmann-Dataset-Model" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the Rossmann Dataset Model"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/my_rossman.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the Rossmann Dataset Model</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/28/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/28/undefined  tle/" itemprop="url">Image Classification-Done Successfully</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-28T07:49:14+09:00">
                2018-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Image Classification is a really exciting task which can be done with Machine Learning. It is really magical to see the Computer understand images by itself.</p>
<p>Machine Learning can do Image Classification with very high accuracy. I would be working on Dogsbreed Dataset. It consists of images of 120 different types of Dogsbreeds, all of which look very similar. I was able to get very high accuracy. Click the link below for the Jupyter Notebook link.<br><em>It is not interactive</em></p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-Dogsbreed-Classification-Model"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-Dogsbreed-Classification-Model" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the Dogsbreed Classification Model"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/dogsbreed.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the Dogsbreed Classification Model</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/undefined  tle/" itemprop="url">LSTM: Text Generator using PyTorch</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-27T22:52:39+09:00">
                2018-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>PyTorch is an open source machine learning library backed by Facebook. It is the new hot thing in the town that everyone is talking about. I tried to see for myself if PyTorch is easier to use than TensorFlow.</p>
<p>We would be working on an LSTM:Text Generator. We would be making RNN models with increasing complexity until we make a LSTM.</p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-LSTM-Text-Generator"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-LSTM-Text-Generator" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the LSTM Text Generator"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/LSTM.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the LSTM Text Generator</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%reload_ext autoreload</span><br><span class="line">%autoreload <span class="number">2</span></span><br><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastai.io <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fastai.conv_learner <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastai.column_data <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=<span class="string">'data/nietzsche/'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text = open(<span class="string">f'<span class="subst">&#123;PATH&#125;</span>nietzsche.txt'</span>).read()</span><br><span class="line">print(<span class="string">'corpus length:'</span>, len(text))</span><br></pre></td></tr></table></figure>
<pre><code>corpus length: 40000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text[:<span class="number">400</span>]</span><br></pre></td></tr></table></figure>
<pre><code>&apos;PREFACE\n\n\nSUPPOSING that Truth is a woman--what then? Is there not ground\nfor suspecting that all philosophers, in so far as they have been\ndogmatists, have failed to understand women--that the terrible\nseriousness and clumsy importunity with which they have usually paid\ntheir addresses to Truth, have been unskilled and unseemly methods for\nwinning a woman? Certainly she has never allowed herself &apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chars = sorted(list(set(text)))</span><br><span class="line">vocab_size = len(chars)+<span class="number">1</span></span><br><span class="line">print(<span class="string">'total chars:'</span>, vocab_size)</span><br></pre></td></tr></table></figure>
<pre><code>total chars: 76
</code></pre><p>Sometimes it’s useful to have a zero value in the dataset, e.g. for padding</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chars.insert(<span class="number">0</span>, <span class="string">"\0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">''</span>.join(chars[<span class="number">1</span>:<span class="number">-6</span>])</span><br></pre></td></tr></table></figure>
<pre><code>&apos;\n !&quot;\&apos;(),-.0123456789:;?ABCDEFGHIJKLMNOPQRSTUVWXY_abcdefghijklmnopqrst&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">char_indices = &#123;c: i <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(chars)&#125;</span><br><span class="line">indices_char = &#123;i: c <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(chars)&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">idx = [char_indices[c] <span class="keyword">for</span> c <span class="keyword">in</span> text]</span><br><span class="line"></span><br><span class="line">idx[:<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<pre><code>[39, 41, 28, 29, 24, 26, 28, 1, 1, 1]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''</span>.join(indices_char[i] <span class="keyword">for</span> i <span class="keyword">in</span> idx[:<span class="number">70</span>])</span><br></pre></td></tr></table></figure>
<pre><code>&apos;PREFACE\n\n\nSUPPOSING that Truth is a woman--what then? Is there not gro&apos;
</code></pre><h2 id="Three-char-model"><a href="#Three-char-model" class="headerlink" title="Three char model"></a>Three char model</h2><h3 id="Create-inputs"><a href="#Create-inputs" class="headerlink" title="Create inputs"></a>Create inputs</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cs=<span class="number">3</span></span><br><span class="line">c1_dat = [idx[i]   <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs, cs)]</span><br><span class="line">c2_dat = [idx[i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs, cs)]</span><br><span class="line">c3_dat = [idx[i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs, cs)]</span><br><span class="line">c4_dat = [idx[i+<span class="number">3</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs, cs)]</span><br></pre></td></tr></table></figure>
<p>Our inputs</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x1 = np.stack(c1_dat)</span><br><span class="line">x2 = np.stack(c2_dat)</span><br><span class="line">x3 = np.stack(c3_dat)</span><br></pre></td></tr></table></figure>
<p>Our output</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y = np.stack(c4_dat)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x1.shape, y.shape</span><br></pre></td></tr></table></figure>
<pre><code>((13333,), (13333,))
</code></pre><h3 id="Create-and-train-model"><a href="#Create-and-train-model" class="headerlink" title="Create and train model"></a>Create and train model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n_hidden = <span class="number">256</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n_fac = <span class="number">42</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Char3Model</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The 'green arrow' from our diagram - the layer operation from input to hidden</span></span><br><span class="line">        self.l_in = nn.Linear(n_fac, n_hidden)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The 'orange arrow' from our diagram - the layer operation from hidden to hidden</span></span><br><span class="line">        self.l_hidden = nn.Linear(n_hidden, n_hidden)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The 'blue arrow' from our diagram - the layer operation from hidden to output</span></span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, c1, c2, c3)</span>:</span></span><br><span class="line">        in1 = F.relu(self.l_in(self.e(c1)))</span><br><span class="line">        in2 = F.relu(self.l_in(self.e(c2)))</span><br><span class="line">        in3 = F.relu(self.l_in(self.e(c3)))</span><br><span class="line"></span><br><span class="line">        h = V(torch.zeros(in1.size()))</span><br><span class="line">        h = F.tanh(self.l_hidden(h+in1))</span><br><span class="line">        h = F.tanh(self.l_hidden(h+in2))</span><br><span class="line">        h = F.tanh(self.l_hidden(h+in3))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(h))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md = ColumnarModelData.from_arrays(<span class="string">'.'</span>, [<span class="number">-1</span>], np.stack([x1,x2,x3], axis=<span class="number">1</span>), y, bs=<span class="number">512</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m = Char3Model(vocab_size, n_fac)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it = iter(md.trn_dl)</span><br><span class="line">*xs,yt = next(it)</span><br><span class="line">t = m(*V(xs))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.911144   3.086874  






[array([3.08687])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">0.001</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.84525  6.52312]                                 
</code></pre><h3 id="Test-model"><a href="#Test-model" class="headerlink" title="Test model"></a>Test model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(inp)</span>:</span></span><br><span class="line">    idxs = T(np.array([char_indices[c] <span class="keyword">for</span> c <span class="keyword">in</span> inp]))</span><br><span class="line">    p = m(*VV(idxs))</span><br><span class="line">    i = np.argmax(to_np(p))</span><br><span class="line">    <span class="keyword">return</span> chars[i]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'y. '</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;p&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'ppl'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;e&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">' th'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;e&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'and'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos; &apos;
</code></pre><h2 id="Our-first-RNN"><a href="#Our-first-RNN" class="headerlink" title="Our first RNN!"></a>Our first RNN!</h2><h3 id="Create-inputs-1"><a href="#Create-inputs-1" class="headerlink" title="Create inputs"></a>Create inputs</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cs=<span class="number">8</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_in_dat = [[idx[i+j] <span class="keyword">for</span> i <span class="keyword">in</span> range(cs)] <span class="keyword">for</span> j <span class="keyword">in</span> range(len(idx)-cs)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_out_dat = [idx[j+cs] <span class="keyword">for</span> j <span class="keyword">in</span> range(len(idx)-cs)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xs = np.stack(c_in_dat, axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xs.shape</span><br></pre></td></tr></table></figure>
<pre><code>(39992, 8)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y = np.stack(c_out_dat)</span><br></pre></td></tr></table></figure>
<h3 id="Create-and-train-model-1"><a href="#Create-and-train-model-1" class="headerlink" title="Create and train model"></a>Create and train model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val_idx = get_cv_idxs(len(idx)-cs<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md = ColumnarModelData.from_arrays(<span class="string">'.'</span>, val_idx, xs, y, bs=<span class="number">512</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharLoopModel</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="comment"># This is an RNN!</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.l_in = nn.Linear(n_fac, n_hidden)</span><br><span class="line">        self.l_hidden = nn.Linear(n_hidden, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, *cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        h = V(torch.zeros(bs, n_hidden))</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> cs:</span><br><span class="line">            inp = F.relu(self.l_in(self.e(c)))</span><br><span class="line">            h = F.tanh(self.l_hidden(h+inp))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(h), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharLoopModel(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.540714   2.313722  






[array([2.31372])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">0.001</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.73588  1.75103]                                 
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharLoopConcatModel</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.l_in = nn.Linear(n_fac+n_hidden, n_hidden)</span><br><span class="line">        self.l_hidden = nn.Linear(n_hidden, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, *cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        h = V(torch.zeros(bs, n_hidden))</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> cs:</span><br><span class="line">            inp = torch.cat((h, self.e(c)), <span class="number">1</span>)</span><br><span class="line">            inp = F.relu(self.l_in(inp))</span><br><span class="line">            h = F.tanh(self.l_hidden(inp))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(h), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharLoopConcatModel(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it = iter(md.trn_dl)</span><br><span class="line">*xs,yt = next(it)</span><br><span class="line">t = m(*V(xs))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.955463   2.684819  






[array([2.68482])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.69008  1.69936]                                 
</code></pre><h3 id="Test-model-1"><a href="#Test-model-1" class="headerlink" title="Test model"></a>Test model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(inp)</span>:</span></span><br><span class="line">    idxs = T(np.array([char_indices[c] <span class="keyword">for</span> c <span class="keyword">in</span> inp]))</span><br><span class="line">    p = m(*VV(idxs))</span><br><span class="line">    i = np.argmax(to_np(p))</span><br><span class="line">    <span class="keyword">return</span> chars[i]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'for thos'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos; &apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'part of '</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;t&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'queens a'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;n&apos;
</code></pre><h2 id="RNN-with-pytorch"><a href="#RNN-with-pytorch" class="headerlink" title="RNN with pytorch"></a>RNN with pytorch</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharRnn</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.RNN(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, *cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br><span class="line">        inp = self.e(torch.stack(cs))</span><br><span class="line">        outp,h = self.rnn(inp, h)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp[<span class="number">-1</span>]), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharRnn(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">it = iter(md.trn_dl)</span><br><span class="line">*xs,yt = next(it)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t = m.e(V(torch.stack(xs)))</span><br><span class="line">t.size()</span><br></pre></td></tr></table></figure>
<pre><code>torch.Size([8, 512, 42])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ht = V(torch.zeros(<span class="number">1</span>, <span class="number">512</span>,n_hidden))</span><br><span class="line">outp, hn = m.rnn(t, ht)</span><br><span class="line">outp.size(), hn.size()</span><br></pre></td></tr></table></figure>
<pre><code>(torch.Size([8, 512, 256]), torch.Size([1, 512, 256]))
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t = m(*V(xs)); t.size()</span><br></pre></td></tr></table></figure>
<pre><code>torch.Size([512, 76])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.86065  1.84255]                                 
[ 1.       1.68014  1.67387]                                 
[ 2.       1.58828  1.59169]                                 
[ 3.       1.52989  1.54942]                                 
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">2</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=2), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.92928    2.668219  
    1      2.611671   2.442238                            






[array([2.44224])]
</code></pre><h3 id="Test-model-2"><a href="#Test-model-2" class="headerlink" title="Test model"></a>Test model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(inp)</span>:</span></span><br><span class="line">    idxs = T(np.array([char_indices[c] <span class="keyword">for</span> c <span class="keyword">in</span> inp]))</span><br><span class="line">    p = m(*VV(idxs))</span><br><span class="line">    i = np.argmax(to_np(p))</span><br><span class="line">    <span class="keyword">return</span> chars[i]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'for thos'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos; &apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_n</span><span class="params">(inp, n)</span>:</span></span><br><span class="line">    res = inp</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        c = get_next(inp)</span><br><span class="line">        res += c</span><br><span class="line">        inp = inp[<span class="number">1</span>:]+c</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next_n(<span class="string">'for thos'</span>, <span class="number">40</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;for thos the the the the the the the the the the&apos;
</code></pre><h2 id="Multi-output-model"><a href="#Multi-output-model" class="headerlink" title="Multi-output model"></a>Multi-output model</h2><h3 id="Setup-1"><a href="#Setup-1" class="headerlink" title="Setup"></a>Setup</h3><p>Let’s take non-overlapping sets of characters this time</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_in_dat = [[idx[i+j] <span class="keyword">for</span> i <span class="keyword">in</span> range(cs)] <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs<span class="number">-1</span>, cs)]</span><br></pre></td></tr></table></figure>
<p>Then create the exact same thing, offset by 1, as our labels</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_out_dat = [[idx[i+j] <span class="keyword">for</span> i <span class="keyword">in</span> range(cs)] <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, len(idx)-cs, cs)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xs = np.stack(c_in_dat)</span><br><span class="line">xs.shape</span><br></pre></td></tr></table></figure>
<pre><code>(4999, 8)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ys = np.stack(c_out_dat)</span><br><span class="line">ys.shape</span><br></pre></td></tr></table></figure>
<pre><code>(4999, 8)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xs[:cs,:cs]</span><br></pre></td></tr></table></figure>
<pre><code>array([[39, 41, 28, 29, 24, 26, 28,  1],
       [ 1,  1, 42, 44, 39, 39, 38, 42],
       [32, 37, 30,  2, 69, 57, 50, 69],
       [ 2, 43, 67, 70, 69, 57,  2, 58],
       [68,  2, 50,  2, 72, 64, 62, 50],
       [63,  9,  9, 72, 57, 50, 69,  2],
       [69, 57, 54, 63, 23,  2, 32, 68],
       [ 2, 69, 57, 54, 67, 54,  2, 63]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ys[:cs,:cs]</span><br></pre></td></tr></table></figure>
<pre><code>array([[41, 28, 29, 24, 26, 28,  1,  1],
       [ 1, 42, 44, 39, 39, 38, 42, 32],
       [37, 30,  2, 69, 57, 50, 69,  2],
       [43, 67, 70, 69, 57,  2, 58, 68],
       [ 2, 50,  2, 72, 64, 62, 50, 63],
       [ 9,  9, 72, 57, 50, 69,  2, 69],
       [57, 54, 63, 23,  2, 32, 68,  2],
       [69, 57, 54, 67, 54,  2, 63, 64]])
</code></pre><h3 id="Create-and-train-model-2"><a href="#Create-and-train-model-2" class="headerlink" title="Create and train model"></a>Create and train model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val_idx = get_cv_idxs(len(xs)-cs<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md = ColumnarModelData.from_arrays(<span class="string">'.'</span>, val_idx, xs, ys, bs=<span class="number">512</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqRnn</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.RNN(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, *cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br><span class="line">        inp = self.e(torch.stack(cs))</span><br><span class="line">        outp,h = self.rnn(inp, h)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqRnn(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">it = iter(md.trn_dl)</span><br><span class="line">*xst,yt = next(it)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nll_loss_seq</span><span class="params">(inp, targ)</span>:</span></span><br><span class="line">    sl,bs,nh = inp.size()</span><br><span class="line">    targ = targ.transpose(<span class="number">0</span>,<span class="number">1</span>).contiguous().view(<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span> F.nll_loss(inp.view(<span class="number">-1</span>,nh), targ)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, nll_loss_seq)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       2.59241  2.40251]                                
[ 1.       2.28474  2.19859]                                
[ 2.       2.13883  2.08836]                                
[ 3.       2.04892  2.01564]                                
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, nll_loss_seq)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                          
    0      4.32723    4.291134  






[array([4.29113])]
</code></pre><h3 id="Identity-init"><a href="#Identity-init" class="headerlink" title="Identity init!"></a>Identity init!</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqRnn(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m.rnn.weight_hh_l0.data.copy_(torch.eye(n_hidden))</span><br></pre></td></tr></table></figure>
<pre><code>    1     0     0  ...      0     0     0
    0     1     0  ...      0     0     0
    0     0     1  ...      0     0     0
       ...          ⋱          ...       
    0     0     0  ...      1     0     0
    0     0     0  ...      0     1     0
    0     0     0  ...      0     0     1
[torch.FloatTensor of size 256x256]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, nll_loss_seq)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=4), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                          
    0      3.490897   3.1025    
    1      3.235987   2.869533                          
    2      3.063832   2.690163                          
    3      2.929215   2.572571                          






[array([2.57257])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, nll_loss_seq)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.84035  1.85742]                                
[ 1.       1.82896  1.84887]                                
[ 2.       1.81879  1.84281]                               
[ 3.       1.81337  1.83801]                                
</code></pre><h2 id="Stateful-model"><a href="#Stateful-model" class="headerlink" title="Stateful model"></a>Stateful model</h2><h3 id="Setup-2"><a href="#Setup-2" class="headerlink" title="Setup"></a>Setup</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchtext <span class="keyword">import</span> vocab, data</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastai.nlp <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fastai.lm_rnn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">PATH=<span class="string">'data/nietzsche/'</span></span><br><span class="line"></span><br><span class="line">TRN_PATH = <span class="string">'trn/'</span></span><br><span class="line">VAL_PATH = <span class="string">'val/'</span></span><br><span class="line">TRN = <span class="string">f'<span class="subst">&#123;PATH&#125;</span><span class="subst">&#123;TRN_PATH&#125;</span>'</span></span><br><span class="line">VAL = <span class="string">f'<span class="subst">&#123;PATH&#125;</span><span class="subst">&#123;VAL_PATH&#125;</span>'</span></span><br><span class="line"></span><br><span class="line">%ls &#123;PATH&#125;</span><br></pre></td></tr></table></figure>
<pre><code>nietzsche.txt       nietzschesmall.txt  [34mtrn[m[m/                [34mval[m[m/
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%ls &#123;PATH&#125;trn</span><br></pre></td></tr></table></figure>
<pre><code>nietzschesmall.txt
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TEXT = data.Field(lower=<span class="keyword">True</span>, tokenize=list)</span><br><span class="line">bs=<span class="number">64</span>; bptt=<span class="number">8</span>; n_fac=<span class="number">42</span>; n_hidden=<span class="number">256</span></span><br><span class="line"></span><br><span class="line">FILES = dict(train=TRN_PATH, validation=VAL_PATH, test=VAL_PATH)</span><br><span class="line">md = LanguageModelData.from_text_files(PATH, TEXT, **FILES, bs=bs, bptt=bptt, min_freq=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">len(md.trn_dl), md.nt, len(md.trn_ds), len(md.trn_ds[<span class="number">0</span>].text)</span><br></pre></td></tr></table></figure>
<pre><code>(75, 45, 1, 39383)
</code></pre><h3 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqStatefulRnn</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac, bs)</span>:</span></span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.RNN(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line">        self.init_hidden(bs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> self.h.size(<span class="number">1</span>) != bs: self.init_hidden(bs)</span><br><span class="line">        outp,h = self.rnn(self.e(cs), self.h)</span><br><span class="line">        self.h = repackage_var(h)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp), dim=<span class="number">-1</span>).view(<span class="number">-1</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self, bs)</span>:</span> self.h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqStatefulRnn(md.nt, n_fac, <span class="number">512</span>)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.81983  1.81247]                                 
[ 1.       1.63097  1.66228]                                 
[ 2.       1.54433  1.57824]                                 
[ 3.       1.48563  1.54505]                                 
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br><span class="line"></span><br><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      3.223129   2.929459  






[array([2.92946])]
</code></pre><h3 id="RNN-loop"><a href="#RNN-loop" class="headerlink" title="RNN loop"></a>RNN loop</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From the pytorch source</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RNNCell</span><span class="params">(input, hidden, w_ih, w_hh, b_ih, b_hh)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> F.tanh(F.linear(input, w_ih, b_ih) + F.linear(hidden, w_hh, b_hh))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqStatefulRnn2</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac, bs)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.RNNCell(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line">        self.init_hidden(bs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> self.h.size(<span class="number">1</span>) != bs: self.init_hidden(bs)</span><br><span class="line">        outp = []</span><br><span class="line">        o = self.h</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> cs:</span><br><span class="line">            o = self.rnn(self.e(c), o)</span><br><span class="line">            outp.append(o)</span><br><span class="line">        outp = self.l_out(torch.stack(outp))</span><br><span class="line">        self.h = repackage_var(o)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(outp, dim=<span class="number">-1</span>).view(<span class="number">-1</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self, bs)</span>:</span> self.h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqStatefulRnn2(md.nt, n_fac, <span class="number">512</span>)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=4), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.634824   2.435599  
    1      2.397607   2.288882                            
    2      2.261155   2.169498                            
    3      2.158415   2.082467                            






[array([2.08247])]
</code></pre><h3 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqStatefulGRU</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac, bs)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.GRU(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line">        self.init_hidden(bs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> self.h.size(<span class="number">1</span>) != bs: self.init_hidden(bs)</span><br><span class="line">        outp,h = self.rnn(self.e(cs), self.h)</span><br><span class="line">        self.h = repackage_var(h)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp), dim=<span class="number">-1</span>).view(<span class="number">-1</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self, bs)</span>:</span> self.h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From the pytorch source code - for reference</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GRUCell</span><span class="params">(input, hidden, w_ih, w_hh, b_ih, b_hh)</span>:</span></span><br><span class="line">    gi = F.linear(input, w_ih, b_ih)</span><br><span class="line">    gh = F.linear(hidden, w_hh, b_hh)</span><br><span class="line">    i_r, i_i, i_n = gi.chunk(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">    h_r, h_i, h_n = gh.chunk(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    resetgate = F.sigmoid(i_r + h_r)</span><br><span class="line">    inputgate = F.sigmoid(i_i + h_i)</span><br><span class="line">    newgate = F.tanh(i_n + resetgate * h_n)</span><br><span class="line">    <span class="keyword">return</span> newgate + inputgate * (hidden - newgate)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqStatefulGRU(md.nt, n_fac, <span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">6</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=6), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.667542   2.425069  
    1      2.371198   2.23098                             
    2      2.207084   2.096106                            
    3      2.081467   1.982581                            
    4      1.971633   1.877548                            
    5      1.877026   1.794282                            






[array([1.79428])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">3</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.22708  1.36926]                                 
[ 1.       1.21948  1.3696 ]                                 
[ 2.       1.22541  1.36969]                                 
</code></pre><h3 id="Putting-it-all-together-LSTM"><a href="#Putting-it-all-together-LSTM" class="headerlink" title="Putting it all together: LSTM"></a>Putting it all together: LSTM</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastai <span class="keyword">import</span> sgdr</span><br><span class="line"></span><br><span class="line">n_hidden=<span class="number">512</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqStatefulLSTM</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac, bs, nl)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.vocab_size,self.nl = vocab_size,nl</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.LSTM(n_fac, n_hidden, nl, dropout=<span class="number">0.5</span>)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line">        self.init_hidden(bs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> self.h[<span class="number">0</span>].size(<span class="number">1</span>) != bs: self.init_hidden(bs)</span><br><span class="line">        outp,h = self.rnn(self.e(cs), self.h)</span><br><span class="line">        self.h = repackage_var(h)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp), dim=<span class="number">-1</span>).view(<span class="number">-1</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self, bs)</span>:</span></span><br><span class="line">        self.h = (V(torch.zeros(self.nl, bs, n_hidden)),</span><br><span class="line">                  V(torch.zeros(self.nl, bs, n_hidden)))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqStatefulLSTM(md.nt, n_fac, <span class="number">512</span>, <span class="number">2</span>)</span><br><span class="line">lo = LayerOptimizer(optim.Adam, m, <span class="number">1e-2</span>, <span class="number">1e-5</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.makedirs(<span class="string">f'<span class="subst">&#123;PATH&#125;</span>models'</span>, exist_ok=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">2</span>, lo.opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=2), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.519296   2.222408  
    1      2.186267   1.941648                            






[array([1.94165])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">on_end = <span class="keyword">lambda</span> sched, cycle: save_model(m, <span class="string">f'<span class="subst">&#123;PATH&#125;</span>models/cyc_<span class="subst">&#123;cycle&#125;</span>'</span>)</span><br><span class="line">cb = [CosAnneal(lo, len(md.trn_dl), cycle_mult=<span class="number">2</span>, on_cycle_end=on_end)]</span><br><span class="line">fit(m, md, <span class="number">1</span>, lo.opt, F.nll_loss, callbacks=cb)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      1.616982   1.337493  





[array([1.33749])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">on_end = <span class="keyword">lambda</span> sched, cycle: save_model(m, <span class="string">f'<span class="subst">&#123;PATH&#125;</span>models/cyc_<span class="subst">&#123;cycle&#125;</span>'</span>)</span><br><span class="line">cb = [CosAnneal(lo, len(md.trn_dl), cycle_mult=<span class="number">2</span>, on_cycle_end=on_end)]</span><br><span class="line">fit(m, md, <span class="number">2</span>**<span class="number">6</span><span class="number">-1</span>, lo.opt, F.nll_loss, callbacks=cb)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.46053  1.43462]                                 
[ 1.       1.51537  1.47747]                                 
[ 2.       1.39208  1.38293]                                 
[ 3.       1.53056  1.49371]                                 
[ 4.       1.46812  1.43389]                                 
[ 5.       1.37624  1.37523]                                 
[ 6.       1.3173   1.34022]                                 
[ 7.       1.51783  1.47554]                                 
[ 8.       1.4921   1.45785]                                 
[ 9.       1.44843  1.42215]                                 
[ 10.        1.40948   1.40858]                              
[ 11.        1.37098   1.36648]                              
[ 12.        1.32255   1.33842]                              
[ 13.        1.28243   1.31106]                              
[ 14.        1.25031   1.2918 ]                              
[ 15.        1.49236   1.45316]                              
[ 16.        1.46041   1.43622]                              
[ 17.        1.45043   1.4498 ]                              
[ 18.        1.43331   1.41297]                              
[ 19.        1.43841   1.41704]                              
[ 20.        1.41536   1.40521]                              
[ 21.        1.39829   1.37656]                              
[ 22.        1.37001   1.36891]                              
[ 23.        1.35469   1.35909]                              
[ 24.        1.32202   1.34228]                              
[ 25.        1.29972   1.32256]                              
[ 26.        1.28007   1.30903]                              
[ 27.        1.24503   1.29125]                              
[ 28.        1.22261   1.28316]                              
[ 29.        1.20563   1.27397]                              
[ 30.        1.18764   1.27178]                              
[ 31.        1.18114   1.26694]                              
[ 32.        1.44344   1.42405]                              
[ 33.        1.43344   1.41616]                              
[ 34.        1.4346    1.40442]                              
[ 35.        1.42152   1.41359]                              
[ 36.        1.42072   1.40835]                              
[ 37.        1.41732   1.40498]                              
[ 38.        1.41268   1.395  ]                              
[ 39.        1.40725   1.39433]                              
[ 40.        1.40181   1.39864]                              
[ 41.        1.38621   1.37549]                              
[ 42.        1.3838    1.38587]                              
[ 43.        1.37644   1.37118]                              
[ 44.        1.36287   1.36211]                              
[ 45.        1.35942   1.36145]                              
[ 46.        1.34712   1.34924]                              
[ 47.        1.32994   1.34884]                              
[ 48.        1.32788   1.33387]                              
[ 49.        1.31553   1.342  ]                              
[ 50.        1.30088   1.32435]                              
[ 51.        1.28446   1.31166]                              
[ 52.        1.27058   1.30807]                              
[ 53.        1.26271   1.29935]                              
[ 54.        1.24351   1.28942]                              
[ 55.        1.23119   1.2838 ]                              
[ 56.        1.2086    1.28364]                              
[ 57.        1.19742   1.27375]                              
[ 58.        1.18127   1.26758]                              
[ 59.        1.17475   1.26858]                              
[ 60.        1.15349   1.25999]                              
[ 61.        1.14718   1.25779]                              
[ 62.        1.13174   1.2524 ]                              
</code></pre><h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(inp)</span>:</span></span><br><span class="line">    idxs = TEXT.numericalize(inp,device=<span class="number">-1</span>)</span><br><span class="line">    p = m(VV(idxs.transpose(<span class="number">0</span>,<span class="number">1</span>)))</span><br><span class="line">    r = torch.multinomial(p[<span class="number">-1</span>].exp(), <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> TEXT.vocab.itos[to_np(r)[<span class="number">0</span>]]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'for thos'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;a&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_n</span><span class="params">(inp, n)</span>:</span></span><br><span class="line">    res = inp</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        c = get_next(inp)</span><br><span class="line">        res += c</span><br><span class="line">        inp = inp[<span class="number">1</span>:]+c</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(get_next_n(<span class="string">'for thos'</span>, <span class="number">400</span>))</span><br></pre></td></tr></table></figure>
<pre><code>for thosal hunscholarigines--ors antion  of that the undressent--and asturebpessomethertogether; and wills. got mo all,watherein perhaps-begaprediced than it will to uppersion icceptameths of the truented term stylless belief your, the subtle&lt;unk&gt; a do long amatiour one could words to cognize of the philosophy, his fain bus-doorg as lesapertion in in shhope conscial or &quot;invermancertay they awayge part of his
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/undefined  tle/" itemprop="url">Life Hacks:The Start</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-27T22:48:23+09:00">
                2018-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>There are lot of tasks which can be automated using programming. Work which usually takes hours, if not days, can be done in minutes. Life Hacks explores some of those tasks and tries to automate them.</p>
<p>Every program is written in such a way that it easily be modified to do a wide range of applications. This is extremely important. The reason being writing a new program for a different task(which is usually the case) takes a long time.</p>
<p>Please contact me by email if there are any bugs.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/undefined  tle/" itemprop="url">Life Hacks:Lucky Google</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-27T22:32:18+09:00">
                2018-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Google is one of the most frequently visited websites on the Internet. People have made huge gains by tweaking the way they use Google. New York Times let people read most article if they come from Google Search link. That’s saving 10$ per month. We would be messing with the Google and playaround with it.</p>
<p>In this program, we would make a program lucky.py which would open the top 5 Google search links in new tab automatically.</p>
<p>We import the following packages</p>
<ol>
<li><em>requests</em> - It gives us some of the functionality of the browser</li>
<li><em>sys</em> - It lets us get the query before code is executed</li>
<li><em>webbrowser</em> - It lets us open the browser</li>
<li><em>bs4</em> - It would help us search the required HTML tag</li>
</ol>
<p>Steps:</p>
<ol>
<li>We get the search query using <em>sys</em></li>
<li>We use <em>bs4</em> to find the URL of top 5 links.</li>
<li>We use <em>webbrowser</em> to open the webbrowser with those links.</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,sys,webbrowser,bs4</span><br><span class="line">print(<span class="string">'Googling....'</span>)</span><br><span class="line">res =requests.get(<span class="string">'http://google.com/search?q='</span>+<span class="string">'+'</span>.join(sys.argv[<span class="number">1</span>:]))</span><br><span class="line"><span class="comment"># print('+'.join(sys.argv[1:]))</span></span><br><span class="line">res.raise_for_status()</span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line">soup=bs4.BeautifulSoup(res.text, <span class="string">"html.parser"</span>)</span><br><span class="line"></span><br><span class="line">linkElems = soup.select(<span class="string">'.r a'</span>)</span><br><span class="line"></span><br><span class="line">numOpen=min(<span class="number">5</span>,len(linkElems))</span><br><span class="line"></span><br><span class="line">webbrowser.open(<span class="string">'http://google.com/search?q='</span>+<span class="string">'+'</span>.join(sys.argv[<span class="number">1</span>:]))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(numOpen):</span><br><span class="line">    webbrowser.open(<span class="string">'http://google.com'</span>+linkElems[i].get(<span class="string">'href'</span>))</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Sahil Bansal</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sahil Bansal</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>

<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Welcome to my World">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Welcome to my World">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Welcome to my World">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Welcome to my World</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Welcome to my World</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about-me">
          <a href="/About-Me" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            About Me
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/19/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/19/undefined  tle/" itemprop="url">Classic Fashion-MNIST Dataset</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-19T14:28:35+09:00">
                2018-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>The original MNIST dataset contains a lot of handwritten digits. Members of the AI/ML/Data Science community love this dataset and use it as a benchmark to validate their algorithms. In fact, MNIST is often the first dataset researchers try. “If it doesn’t work on MNIST, it won’t work at all”, they said. “Well, if it does work on MNIST, it may still fail on others.”</p>
<p><strong>To Serious Machine Learning Researchers</strong></p>
<ol>
<li><p>MNIST is too easy.</p>
</li>
<li><p>MNIST is overused.</p>
</li>
<li><p>MNIST can not represent modern CV tasks.</p>
</li>
</ol>
<p>MNIST Dataset contains 60000 images of 10 different classes.<br>I was able to get an accuracy of 91.2 % on this Dataset.<br><em>It is not interactive</em></p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-Fashion-mnist-Classification-Model"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-Fashion-mnist-Classification-Model" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the Fashion-mnist Classification Model"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/fashionmnistsaved.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the Fashion-mnist Classification Model</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/28/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/28/undefined  tle/" itemprop="url">Supervised Learning on very Large Dataset</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-28T15:31:41+09:00">
                2018-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Supervised Learning is unarguable one of the most important use-case for Machine Learning. And yet its important is not recognised by most researchers. Supervised Learning makes up a large fraction of the work done by AI companies. Being Proficient in Supervised learning would really help the company satisfy their client faster and enable them to earn more profit.</p>
<p>In this task, I worked on Rossmann Dataset. Rossmann Dataset consists of data of all German Supermarket. The task is to predict sales for next 2 weeks. Click below for the Jupyter Notebook Link.<br><em>It is not interactive</em></p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-Rossmann-Dataset-Model"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-Rossmann-Dataset-Model" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the Rossmann Dataset Model"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/my_rossman.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the Rossmann Dataset Model</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/28/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/28/undefined  tle/" itemprop="url">Image Classification-Done Successfully</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-28T07:49:14+09:00">
                2018-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Image Classification is a really exciting task which can be done with Machine Learning. It is really magical to see the Computer understand images by itself.</p>
<p>Machine Learning can do Image Classification with very high accuracy. I would be working on Dogsbreed Dataset. It consists of images of 120 different types of Dogsbreeds, all of which look very similar. I was able to get very high accuracy. Click the link below for the Jupyter Notebook link.<br><em>It is not interactive</em></p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-Dogsbreed-Classification-Model"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-Dogsbreed-Classification-Model" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the Dogsbreed Classification Model"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/dogsbreed.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the Dogsbreed Classification Model</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/undefined  tle/" itemprop="url">LSTM: Text Generator using PyTorch</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-27T22:52:39+09:00">
                2018-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>PyTorch is an open source machine learning library backed by Facebook. It is the new hot thing in the town that everyone is talking about. I tried to see for myself if PyTorch is easier to use than TensorFlow.</p>
<p>We would be working on an LSTM:Text Generator. We would be making RNN models with increasing complexity until we make a LSTM.</p>
<h4 id="Visit-GITHUB-for-Jupyter-Notebook-of-the-LSTM-Text-Generator"><a href="#Visit-GITHUB-for-Jupyter-Notebook-of-the-LSTM-Text-Generator" class="headerlink" title="Visit    GITHUB for Jupyter Notebook of the LSTM Text Generator"></a>Visit    <a href="https://github.com/S-hil/deeplearning-models/blob/master/LSTM.ipynb" target="_blank" rel="noopener"><strong>GITHUB</strong></a> for Jupyter Notebook of the LSTM Text Generator</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%reload_ext autoreload</span><br><span class="line">%autoreload <span class="number">2</span></span><br><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastai.io <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fastai.conv_learner <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastai.column_data <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=<span class="string">'data/nietzsche/'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text = open(<span class="string">f'<span class="subst">&#123;PATH&#125;</span>nietzsche.txt'</span>).read()</span><br><span class="line">print(<span class="string">'corpus length:'</span>, len(text))</span><br></pre></td></tr></table></figure>
<pre><code>corpus length: 40000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text[:<span class="number">400</span>]</span><br></pre></td></tr></table></figure>
<pre><code>&apos;PREFACE\n\n\nSUPPOSING that Truth is a woman--what then? Is there not ground\nfor suspecting that all philosophers, in so far as they have been\ndogmatists, have failed to understand women--that the terrible\nseriousness and clumsy importunity with which they have usually paid\ntheir addresses to Truth, have been unskilled and unseemly methods for\nwinning a woman? Certainly she has never allowed herself &apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chars = sorted(list(set(text)))</span><br><span class="line">vocab_size = len(chars)+<span class="number">1</span></span><br><span class="line">print(<span class="string">'total chars:'</span>, vocab_size)</span><br></pre></td></tr></table></figure>
<pre><code>total chars: 76
</code></pre><p>Sometimes it’s useful to have a zero value in the dataset, e.g. for padding</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chars.insert(<span class="number">0</span>, <span class="string">"\0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">''</span>.join(chars[<span class="number">1</span>:<span class="number">-6</span>])</span><br></pre></td></tr></table></figure>
<pre><code>&apos;\n !&quot;\&apos;(),-.0123456789:;?ABCDEFGHIJKLMNOPQRSTUVWXY_abcdefghijklmnopqrst&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">char_indices = &#123;c: i <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(chars)&#125;</span><br><span class="line">indices_char = &#123;i: c <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(chars)&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">idx = [char_indices[c] <span class="keyword">for</span> c <span class="keyword">in</span> text]</span><br><span class="line"></span><br><span class="line">idx[:<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<pre><code>[39, 41, 28, 29, 24, 26, 28, 1, 1, 1]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''</span>.join(indices_char[i] <span class="keyword">for</span> i <span class="keyword">in</span> idx[:<span class="number">70</span>])</span><br></pre></td></tr></table></figure>
<pre><code>&apos;PREFACE\n\n\nSUPPOSING that Truth is a woman--what then? Is there not gro&apos;
</code></pre><h2 id="Three-char-model"><a href="#Three-char-model" class="headerlink" title="Three char model"></a>Three char model</h2><h3 id="Create-inputs"><a href="#Create-inputs" class="headerlink" title="Create inputs"></a>Create inputs</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cs=<span class="number">3</span></span><br><span class="line">c1_dat = [idx[i]   <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs, cs)]</span><br><span class="line">c2_dat = [idx[i+<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs, cs)]</span><br><span class="line">c3_dat = [idx[i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs, cs)]</span><br><span class="line">c4_dat = [idx[i+<span class="number">3</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs, cs)]</span><br></pre></td></tr></table></figure>
<p>Our inputs</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x1 = np.stack(c1_dat)</span><br><span class="line">x2 = np.stack(c2_dat)</span><br><span class="line">x3 = np.stack(c3_dat)</span><br></pre></td></tr></table></figure>
<p>Our output</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y = np.stack(c4_dat)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x1.shape, y.shape</span><br></pre></td></tr></table></figure>
<pre><code>((13333,), (13333,))
</code></pre><h3 id="Create-and-train-model"><a href="#Create-and-train-model" class="headerlink" title="Create and train model"></a>Create and train model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n_hidden = <span class="number">256</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n_fac = <span class="number">42</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Char3Model</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The 'green arrow' from our diagram - the layer operation from input to hidden</span></span><br><span class="line">        self.l_in = nn.Linear(n_fac, n_hidden)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The 'orange arrow' from our diagram - the layer operation from hidden to hidden</span></span><br><span class="line">        self.l_hidden = nn.Linear(n_hidden, n_hidden)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># The 'blue arrow' from our diagram - the layer operation from hidden to output</span></span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, c1, c2, c3)</span>:</span></span><br><span class="line">        in1 = F.relu(self.l_in(self.e(c1)))</span><br><span class="line">        in2 = F.relu(self.l_in(self.e(c2)))</span><br><span class="line">        in3 = F.relu(self.l_in(self.e(c3)))</span><br><span class="line"></span><br><span class="line">        h = V(torch.zeros(in1.size()))</span><br><span class="line">        h = F.tanh(self.l_hidden(h+in1))</span><br><span class="line">        h = F.tanh(self.l_hidden(h+in2))</span><br><span class="line">        h = F.tanh(self.l_hidden(h+in3))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(h))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md = ColumnarModelData.from_arrays(<span class="string">'.'</span>, [<span class="number">-1</span>], np.stack([x1,x2,x3], axis=<span class="number">1</span>), y, bs=<span class="number">512</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m = Char3Model(vocab_size, n_fac)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it = iter(md.trn_dl)</span><br><span class="line">*xs,yt = next(it)</span><br><span class="line">t = m(*V(xs))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.911144   3.086874  






[array([3.08687])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">0.001</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.84525  6.52312]                                 
</code></pre><h3 id="Test-model"><a href="#Test-model" class="headerlink" title="Test model"></a>Test model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(inp)</span>:</span></span><br><span class="line">    idxs = T(np.array([char_indices[c] <span class="keyword">for</span> c <span class="keyword">in</span> inp]))</span><br><span class="line">    p = m(*VV(idxs))</span><br><span class="line">    i = np.argmax(to_np(p))</span><br><span class="line">    <span class="keyword">return</span> chars[i]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'y. '</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;p&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'ppl'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;e&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">' th'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;e&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'and'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos; &apos;
</code></pre><h2 id="Our-first-RNN"><a href="#Our-first-RNN" class="headerlink" title="Our first RNN!"></a>Our first RNN!</h2><h3 id="Create-inputs-1"><a href="#Create-inputs-1" class="headerlink" title="Create inputs"></a>Create inputs</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cs=<span class="number">8</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_in_dat = [[idx[i+j] <span class="keyword">for</span> i <span class="keyword">in</span> range(cs)] <span class="keyword">for</span> j <span class="keyword">in</span> range(len(idx)-cs)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_out_dat = [idx[j+cs] <span class="keyword">for</span> j <span class="keyword">in</span> range(len(idx)-cs)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xs = np.stack(c_in_dat, axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xs.shape</span><br></pre></td></tr></table></figure>
<pre><code>(39992, 8)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y = np.stack(c_out_dat)</span><br></pre></td></tr></table></figure>
<h3 id="Create-and-train-model-1"><a href="#Create-and-train-model-1" class="headerlink" title="Create and train model"></a>Create and train model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val_idx = get_cv_idxs(len(idx)-cs<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md = ColumnarModelData.from_arrays(<span class="string">'.'</span>, val_idx, xs, y, bs=<span class="number">512</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharLoopModel</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="comment"># This is an RNN!</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.l_in = nn.Linear(n_fac, n_hidden)</span><br><span class="line">        self.l_hidden = nn.Linear(n_hidden, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, *cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        h = V(torch.zeros(bs, n_hidden))</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> cs:</span><br><span class="line">            inp = F.relu(self.l_in(self.e(c)))</span><br><span class="line">            h = F.tanh(self.l_hidden(h+inp))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(h), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharLoopModel(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.540714   2.313722  






[array([2.31372])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">0.001</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.73588  1.75103]                                 
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharLoopConcatModel</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.l_in = nn.Linear(n_fac+n_hidden, n_hidden)</span><br><span class="line">        self.l_hidden = nn.Linear(n_hidden, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, *cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        h = V(torch.zeros(bs, n_hidden))</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> cs:</span><br><span class="line">            inp = torch.cat((h, self.e(c)), <span class="number">1</span>)</span><br><span class="line">            inp = F.relu(self.l_in(inp))</span><br><span class="line">            h = F.tanh(self.l_hidden(inp))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(h), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharLoopConcatModel(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">it = iter(md.trn_dl)</span><br><span class="line">*xs,yt = next(it)</span><br><span class="line">t = m(*V(xs))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.955463   2.684819  






[array([2.68482])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.69008  1.69936]                                 
</code></pre><h3 id="Test-model-1"><a href="#Test-model-1" class="headerlink" title="Test model"></a>Test model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(inp)</span>:</span></span><br><span class="line">    idxs = T(np.array([char_indices[c] <span class="keyword">for</span> c <span class="keyword">in</span> inp]))</span><br><span class="line">    p = m(*VV(idxs))</span><br><span class="line">    i = np.argmax(to_np(p))</span><br><span class="line">    <span class="keyword">return</span> chars[i]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'for thos'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos; &apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'part of '</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;t&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'queens a'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;n&apos;
</code></pre><h2 id="RNN-with-pytorch"><a href="#RNN-with-pytorch" class="headerlink" title="RNN with pytorch"></a>RNN with pytorch</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharRnn</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.RNN(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, *cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br><span class="line">        inp = self.e(torch.stack(cs))</span><br><span class="line">        outp,h = self.rnn(inp, h)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp[<span class="number">-1</span>]), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharRnn(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">it = iter(md.trn_dl)</span><br><span class="line">*xs,yt = next(it)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t = m.e(V(torch.stack(xs)))</span><br><span class="line">t.size()</span><br></pre></td></tr></table></figure>
<pre><code>torch.Size([8, 512, 42])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ht = V(torch.zeros(<span class="number">1</span>, <span class="number">512</span>,n_hidden))</span><br><span class="line">outp, hn = m.rnn(t, ht)</span><br><span class="line">outp.size(), hn.size()</span><br></pre></td></tr></table></figure>
<pre><code>(torch.Size([8, 512, 256]), torch.Size([1, 512, 256]))
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t = m(*V(xs)); t.size()</span><br></pre></td></tr></table></figure>
<pre><code>torch.Size([512, 76])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.86065  1.84255]                                 
[ 1.       1.68014  1.67387]                                 
[ 2.       1.58828  1.59169]                                 
[ 3.       1.52989  1.54942]                                 
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">2</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=2), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.92928    2.668219  
    1      2.611671   2.442238                            






[array([2.44224])]
</code></pre><h3 id="Test-model-2"><a href="#Test-model-2" class="headerlink" title="Test model"></a>Test model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(inp)</span>:</span></span><br><span class="line">    idxs = T(np.array([char_indices[c] <span class="keyword">for</span> c <span class="keyword">in</span> inp]))</span><br><span class="line">    p = m(*VV(idxs))</span><br><span class="line">    i = np.argmax(to_np(p))</span><br><span class="line">    <span class="keyword">return</span> chars[i]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'for thos'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos; &apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_n</span><span class="params">(inp, n)</span>:</span></span><br><span class="line">    res = inp</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        c = get_next(inp)</span><br><span class="line">        res += c</span><br><span class="line">        inp = inp[<span class="number">1</span>:]+c</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next_n(<span class="string">'for thos'</span>, <span class="number">40</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;for thos the the the the the the the the the the&apos;
</code></pre><h2 id="Multi-output-model"><a href="#Multi-output-model" class="headerlink" title="Multi-output model"></a>Multi-output model</h2><h3 id="Setup-1"><a href="#Setup-1" class="headerlink" title="Setup"></a>Setup</h3><p>Let’s take non-overlapping sets of characters this time</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_in_dat = [[idx[i+j] <span class="keyword">for</span> i <span class="keyword">in</span> range(cs)] <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, len(idx)-cs<span class="number">-1</span>, cs)]</span><br></pre></td></tr></table></figure>
<p>Then create the exact same thing, offset by 1, as our labels</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_out_dat = [[idx[i+j] <span class="keyword">for</span> i <span class="keyword">in</span> range(cs)] <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, len(idx)-cs, cs)]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xs = np.stack(c_in_dat)</span><br><span class="line">xs.shape</span><br></pre></td></tr></table></figure>
<pre><code>(4999, 8)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ys = np.stack(c_out_dat)</span><br><span class="line">ys.shape</span><br></pre></td></tr></table></figure>
<pre><code>(4999, 8)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xs[:cs,:cs]</span><br></pre></td></tr></table></figure>
<pre><code>array([[39, 41, 28, 29, 24, 26, 28,  1],
       [ 1,  1, 42, 44, 39, 39, 38, 42],
       [32, 37, 30,  2, 69, 57, 50, 69],
       [ 2, 43, 67, 70, 69, 57,  2, 58],
       [68,  2, 50,  2, 72, 64, 62, 50],
       [63,  9,  9, 72, 57, 50, 69,  2],
       [69, 57, 54, 63, 23,  2, 32, 68],
       [ 2, 69, 57, 54, 67, 54,  2, 63]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ys[:cs,:cs]</span><br></pre></td></tr></table></figure>
<pre><code>array([[41, 28, 29, 24, 26, 28,  1,  1],
       [ 1, 42, 44, 39, 39, 38, 42, 32],
       [37, 30,  2, 69, 57, 50, 69,  2],
       [43, 67, 70, 69, 57,  2, 58, 68],
       [ 2, 50,  2, 72, 64, 62, 50, 63],
       [ 9,  9, 72, 57, 50, 69,  2, 69],
       [57, 54, 63, 23,  2, 32, 68,  2],
       [69, 57, 54, 67, 54,  2, 63, 64]])
</code></pre><h3 id="Create-and-train-model-2"><a href="#Create-and-train-model-2" class="headerlink" title="Create and train model"></a>Create and train model</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val_idx = get_cv_idxs(len(xs)-cs<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md = ColumnarModelData.from_arrays(<span class="string">'.'</span>, val_idx, xs, ys, bs=<span class="number">512</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqRnn</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.RNN(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, *cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br><span class="line">        inp = self.e(torch.stack(cs))</span><br><span class="line">        outp,h = self.rnn(inp, h)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp), dim=<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqRnn(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">it = iter(md.trn_dl)</span><br><span class="line">*xst,yt = next(it)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nll_loss_seq</span><span class="params">(inp, targ)</span>:</span></span><br><span class="line">    sl,bs,nh = inp.size()</span><br><span class="line">    targ = targ.transpose(<span class="number">0</span>,<span class="number">1</span>).contiguous().view(<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span> F.nll_loss(inp.view(<span class="number">-1</span>,nh), targ)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, nll_loss_seq)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       2.59241  2.40251]                                
[ 1.       2.28474  2.19859]                                
[ 2.       2.13883  2.08836]                                
[ 3.       2.04892  2.01564]                                
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">1</span>, opt, nll_loss_seq)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                          
    0      4.32723    4.291134  






[array([4.29113])]
</code></pre><h3 id="Identity-init"><a href="#Identity-init" class="headerlink" title="Identity init!"></a>Identity init!</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqRnn(vocab_size, n_fac)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-2</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m.rnn.weight_hh_l0.data.copy_(torch.eye(n_hidden))</span><br></pre></td></tr></table></figure>
<pre><code>    1     0     0  ...      0     0     0
    0     1     0  ...      0     0     0
    0     0     1  ...      0     0     0
       ...          ⋱          ...       
    0     0     0  ...      1     0     0
    0     0     0  ...      0     1     0
    0     0     0  ...      0     0     1
[torch.FloatTensor of size 256x256]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, nll_loss_seq)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=4), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                          
    0      3.490897   3.1025    
    1      3.235987   2.869533                          
    2      3.063832   2.690163                          
    3      2.929215   2.572571                          






[array([2.57257])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, nll_loss_seq)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.84035  1.85742]                                
[ 1.       1.82896  1.84887]                                
[ 2.       1.81879  1.84281]                               
[ 3.       1.81337  1.83801]                                
</code></pre><h2 id="Stateful-model"><a href="#Stateful-model" class="headerlink" title="Stateful model"></a>Stateful model</h2><h3 id="Setup-2"><a href="#Setup-2" class="headerlink" title="Setup"></a>Setup</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchtext <span class="keyword">import</span> vocab, data</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastai.nlp <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fastai.lm_rnn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">PATH=<span class="string">'data/nietzsche/'</span></span><br><span class="line"></span><br><span class="line">TRN_PATH = <span class="string">'trn/'</span></span><br><span class="line">VAL_PATH = <span class="string">'val/'</span></span><br><span class="line">TRN = <span class="string">f'<span class="subst">&#123;PATH&#125;</span><span class="subst">&#123;TRN_PATH&#125;</span>'</span></span><br><span class="line">VAL = <span class="string">f'<span class="subst">&#123;PATH&#125;</span><span class="subst">&#123;VAL_PATH&#125;</span>'</span></span><br><span class="line"></span><br><span class="line">%ls &#123;PATH&#125;</span><br></pre></td></tr></table></figure>
<pre><code>nietzsche.txt       nietzschesmall.txt  [34mtrn[m[m/                [34mval[m[m/
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%ls &#123;PATH&#125;trn</span><br></pre></td></tr></table></figure>
<pre><code>nietzschesmall.txt
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TEXT = data.Field(lower=<span class="keyword">True</span>, tokenize=list)</span><br><span class="line">bs=<span class="number">64</span>; bptt=<span class="number">8</span>; n_fac=<span class="number">42</span>; n_hidden=<span class="number">256</span></span><br><span class="line"></span><br><span class="line">FILES = dict(train=TRN_PATH, validation=VAL_PATH, test=VAL_PATH)</span><br><span class="line">md = LanguageModelData.from_text_files(PATH, TEXT, **FILES, bs=bs, bptt=bptt, min_freq=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">len(md.trn_dl), md.nt, len(md.trn_ds), len(md.trn_ds[<span class="number">0</span>].text)</span><br></pre></td></tr></table></figure>
<pre><code>(75, 45, 1, 39383)
</code></pre><h3 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqStatefulRnn</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac, bs)</span>:</span></span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.RNN(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line">        self.init_hidden(bs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> self.h.size(<span class="number">1</span>) != bs: self.init_hidden(bs)</span><br><span class="line">        outp,h = self.rnn(self.e(cs), self.h)</span><br><span class="line">        self.h = repackage_var(h)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp), dim=<span class="number">-1</span>).view(<span class="number">-1</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self, bs)</span>:</span> self.h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqStatefulRnn(md.nt, n_fac, <span class="number">512</span>)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.81983  1.81247]                                 
[ 1.       1.63097  1.66228]                                 
[ 2.       1.54433  1.57824]                                 
[ 3.       1.48563  1.54505]                                 
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br><span class="line"></span><br><span class="line">fit(m, md, <span class="number">1</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      3.223129   2.929459  






[array([2.92946])]
</code></pre><h3 id="RNN-loop"><a href="#RNN-loop" class="headerlink" title="RNN loop"></a>RNN loop</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From the pytorch source</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RNNCell</span><span class="params">(input, hidden, w_ih, w_hh, b_ih, b_hh)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> F.tanh(F.linear(input, w_ih, b_ih) + F.linear(hidden, w_hh, b_hh))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqStatefulRnn2</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac, bs)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.RNNCell(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line">        self.init_hidden(bs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> self.h.size(<span class="number">1</span>) != bs: self.init_hidden(bs)</span><br><span class="line">        outp = []</span><br><span class="line">        o = self.h</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> cs:</span><br><span class="line">            o = self.rnn(self.e(c), o)</span><br><span class="line">            outp.append(o)</span><br><span class="line">        outp = self.l_out(torch.stack(outp))</span><br><span class="line">        self.h = repackage_var(o)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(outp, dim=<span class="number">-1</span>).view(<span class="number">-1</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self, bs)</span>:</span> self.h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqStatefulRnn2(md.nt, n_fac, <span class="number">512</span>)</span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">4</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=4), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.634824   2.435599  
    1      2.397607   2.288882                            
    2      2.261155   2.169498                            
    3      2.158415   2.082467                            






[array([2.08247])]
</code></pre><h3 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqStatefulGRU</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac, bs)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.GRU(n_fac, n_hidden)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line">        self.init_hidden(bs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> self.h.size(<span class="number">1</span>) != bs: self.init_hidden(bs)</span><br><span class="line">        outp,h = self.rnn(self.e(cs), self.h)</span><br><span class="line">        self.h = repackage_var(h)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp), dim=<span class="number">-1</span>).view(<span class="number">-1</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self, bs)</span>:</span> self.h = V(torch.zeros(<span class="number">1</span>, bs, n_hidden))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From the pytorch source code - for reference</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GRUCell</span><span class="params">(input, hidden, w_ih, w_hh, b_ih, b_hh)</span>:</span></span><br><span class="line">    gi = F.linear(input, w_ih, b_ih)</span><br><span class="line">    gh = F.linear(hidden, w_hh, b_hh)</span><br><span class="line">    i_r, i_i, i_n = gi.chunk(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">    h_r, h_i, h_n = gh.chunk(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    resetgate = F.sigmoid(i_r + h_r)</span><br><span class="line">    inputgate = F.sigmoid(i_i + h_i)</span><br><span class="line">    newgate = F.tanh(i_n + resetgate * h_n)</span><br><span class="line">    <span class="keyword">return</span> newgate + inputgate * (hidden - newgate)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqStatefulGRU(md.nt, n_fac, <span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">opt = optim.Adam(m.parameters(), <span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">6</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=6), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.667542   2.425069  
    1      2.371198   2.23098                             
    2      2.207084   2.096106                            
    3      2.081467   1.982581                            
    4      1.971633   1.877548                            
    5      1.877026   1.794282                            






[array([1.79428])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set_lrs(opt, <span class="number">1e-4</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">3</span>, opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.22708  1.36926]                                 
[ 1.       1.21948  1.3696 ]                                 
[ 2.       1.22541  1.36969]                                 
</code></pre><h3 id="Putting-it-all-together-LSTM"><a href="#Putting-it-all-together-LSTM" class="headerlink" title="Putting it all together: LSTM"></a>Putting it all together: LSTM</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastai <span class="keyword">import</span> sgdr</span><br><span class="line"></span><br><span class="line">n_hidden=<span class="number">512</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CharSeqStatefulLSTM</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, vocab_size, n_fac, bs, nl)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.vocab_size,self.nl = vocab_size,nl</span><br><span class="line">        self.e = nn.Embedding(vocab_size, n_fac)</span><br><span class="line">        self.rnn = nn.LSTM(n_fac, n_hidden, nl, dropout=<span class="number">0.5</span>)</span><br><span class="line">        self.l_out = nn.Linear(n_hidden, vocab_size)</span><br><span class="line">        self.init_hidden(bs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, cs)</span>:</span></span><br><span class="line">        bs = cs[<span class="number">0</span>].size(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> self.h[<span class="number">0</span>].size(<span class="number">1</span>) != bs: self.init_hidden(bs)</span><br><span class="line">        outp,h = self.rnn(self.e(cs), self.h)</span><br><span class="line">        self.h = repackage_var(h)</span><br><span class="line">        <span class="keyword">return</span> F.log_softmax(self.l_out(outp), dim=<span class="number">-1</span>).view(<span class="number">-1</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_hidden</span><span class="params">(self, bs)</span>:</span></span><br><span class="line">        self.h = (V(torch.zeros(self.nl, bs, n_hidden)),</span><br><span class="line">                  V(torch.zeros(self.nl, bs, n_hidden)))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m = CharSeqStatefulLSTM(md.nt, n_fac, <span class="number">512</span>, <span class="number">2</span>)</span><br><span class="line">lo = LayerOptimizer(optim.Adam, m, <span class="number">1e-2</span>, <span class="number">1e-5</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.makedirs(<span class="string">f'<span class="subst">&#123;PATH&#125;</span>models'</span>, exist_ok=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit(m, md, <span class="number">2</span>, lo.opt, F.nll_loss)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=2), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      2.519296   2.222408  
    1      2.186267   1.941648                            






[array([1.94165])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">on_end = <span class="keyword">lambda</span> sched, cycle: save_model(m, <span class="string">f'<span class="subst">&#123;PATH&#125;</span>models/cyc_<span class="subst">&#123;cycle&#125;</span>'</span>)</span><br><span class="line">cb = [CosAnneal(lo, len(md.trn_dl), cycle_mult=<span class="number">2</span>, on_cycle_end=on_end)]</span><br><span class="line">fit(m, md, <span class="number">1</span>, lo.opt, F.nll_loss, callbacks=cb)</span><br></pre></td></tr></table></figure>
<pre><code>HBox(children=(IntProgress(value=0, description=&apos;Epoch&apos;, max=1), HTML(value=&apos;&apos;)))


epoch      trn_loss   val_loss                            
    0      1.616982   1.337493  





[array([1.33749])]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">on_end = <span class="keyword">lambda</span> sched, cycle: save_model(m, <span class="string">f'<span class="subst">&#123;PATH&#125;</span>models/cyc_<span class="subst">&#123;cycle&#125;</span>'</span>)</span><br><span class="line">cb = [CosAnneal(lo, len(md.trn_dl), cycle_mult=<span class="number">2</span>, on_cycle_end=on_end)]</span><br><span class="line">fit(m, md, <span class="number">2</span>**<span class="number">6</span><span class="number">-1</span>, lo.opt, F.nll_loss, callbacks=cb)</span><br></pre></td></tr></table></figure>
<pre><code>A Jupyter Widget


[ 0.       1.46053  1.43462]                                 
[ 1.       1.51537  1.47747]                                 
[ 2.       1.39208  1.38293]                                 
[ 3.       1.53056  1.49371]                                 
[ 4.       1.46812  1.43389]                                 
[ 5.       1.37624  1.37523]                                 
[ 6.       1.3173   1.34022]                                 
[ 7.       1.51783  1.47554]                                 
[ 8.       1.4921   1.45785]                                 
[ 9.       1.44843  1.42215]                                 
[ 10.        1.40948   1.40858]                              
[ 11.        1.37098   1.36648]                              
[ 12.        1.32255   1.33842]                              
[ 13.        1.28243   1.31106]                              
[ 14.        1.25031   1.2918 ]                              
[ 15.        1.49236   1.45316]                              
[ 16.        1.46041   1.43622]                              
[ 17.        1.45043   1.4498 ]                              
[ 18.        1.43331   1.41297]                              
[ 19.        1.43841   1.41704]                              
[ 20.        1.41536   1.40521]                              
[ 21.        1.39829   1.37656]                              
[ 22.        1.37001   1.36891]                              
[ 23.        1.35469   1.35909]                              
[ 24.        1.32202   1.34228]                              
[ 25.        1.29972   1.32256]                              
[ 26.        1.28007   1.30903]                              
[ 27.        1.24503   1.29125]                              
[ 28.        1.22261   1.28316]                              
[ 29.        1.20563   1.27397]                              
[ 30.        1.18764   1.27178]                              
[ 31.        1.18114   1.26694]                              
[ 32.        1.44344   1.42405]                              
[ 33.        1.43344   1.41616]                              
[ 34.        1.4346    1.40442]                              
[ 35.        1.42152   1.41359]                              
[ 36.        1.42072   1.40835]                              
[ 37.        1.41732   1.40498]                              
[ 38.        1.41268   1.395  ]                              
[ 39.        1.40725   1.39433]                              
[ 40.        1.40181   1.39864]                              
[ 41.        1.38621   1.37549]                              
[ 42.        1.3838    1.38587]                              
[ 43.        1.37644   1.37118]                              
[ 44.        1.36287   1.36211]                              
[ 45.        1.35942   1.36145]                              
[ 46.        1.34712   1.34924]                              
[ 47.        1.32994   1.34884]                              
[ 48.        1.32788   1.33387]                              
[ 49.        1.31553   1.342  ]                              
[ 50.        1.30088   1.32435]                              
[ 51.        1.28446   1.31166]                              
[ 52.        1.27058   1.30807]                              
[ 53.        1.26271   1.29935]                              
[ 54.        1.24351   1.28942]                              
[ 55.        1.23119   1.2838 ]                              
[ 56.        1.2086    1.28364]                              
[ 57.        1.19742   1.27375]                              
[ 58.        1.18127   1.26758]                              
[ 59.        1.17475   1.26858]                              
[ 60.        1.15349   1.25999]                              
[ 61.        1.14718   1.25779]                              
[ 62.        1.13174   1.2524 ]                              
</code></pre><h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next</span><span class="params">(inp)</span>:</span></span><br><span class="line">    idxs = TEXT.numericalize(inp,device=<span class="number">-1</span>)</span><br><span class="line">    p = m(VV(idxs.transpose(<span class="number">0</span>,<span class="number">1</span>)))</span><br><span class="line">    r = torch.multinomial(p[<span class="number">-1</span>].exp(), <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> TEXT.vocab.itos[to_np(r)[<span class="number">0</span>]]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_next(<span class="string">'for thos'</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&apos;a&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_n</span><span class="params">(inp, n)</span>:</span></span><br><span class="line">    res = inp</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        c = get_next(inp)</span><br><span class="line">        res += c</span><br><span class="line">        inp = inp[<span class="number">1</span>:]+c</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(get_next_n(<span class="string">'for thos'</span>, <span class="number">400</span>))</span><br></pre></td></tr></table></figure>
<pre><code>for thosal hunscholarigines--ors antion  of that the undressent--and asturebpessomethertogether; and wills. got mo all,watherein perhaps-begaprediced than it will to uppersion icceptameths of the truented term stylless belief your, the subtle&lt;unk&gt; a do long amatiour one could words to cognize of the philosophy, his fain bus-doorg as lesapertion in in shhope conscial or &quot;invermancertay they awayge part of his
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/undefined  tle/" itemprop="url">Life Hacks:The Start</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-27T22:48:23+09:00">
                2018-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>There are lot of tasks which can be automated using programming. Work which usually takes hours, if not days, can be done in minutes. Life Hacks explores some of those tasks and tries to automate them.</p>
<p>Every program is written in such a way that it easily be modified to do a wide range of applications. This is extremely important. The reason being writing a new program for a different task(which is usually the case) takes a long time.</p>
<p>Please contact me by email if there are any bugs.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/undefined  tle/" itemprop="url">Life Hacks:Lucky Google</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-27T22:32:18+09:00">
                2018-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Google is one of the most frequently visited websites on the Internet. People have made huge gains by tweaking the way they use Google. New York Times let people read most article if they come from Google Search link. That’s saving 10$ per month. We would be messing with the Google and playaround with it.</p>
<p>In this program, we would make a program lucky.py which would open the top 5 Google search links in new tab automatically.</p>
<p>We import the following packages</p>
<ol>
<li><em>requests</em> - It gives us some of the functionality of the browser</li>
<li><em>sys</em> - It lets us get the query before code is executed</li>
<li><em>webbrowser</em> - It lets us open the browser</li>
<li><em>bs4</em> - It would help us search the required HTML tag</li>
</ol>
<p>Steps:</p>
<ol>
<li>We get the search query using <em>sys</em></li>
<li>We use <em>bs4</em> to find the URL of top 5 links.</li>
<li>We use <em>webbrowser</em> to open the webbrowser with those links.</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,sys,webbrowser,bs4</span><br><span class="line">print(<span class="string">'Googling....'</span>)</span><br><span class="line">res =requests.get(<span class="string">'http://google.com/search?q='</span>+<span class="string">'+'</span>.join(sys.argv[<span class="number">1</span>:]))</span><br><span class="line"><span class="comment"># print('+'.join(sys.argv[1:]))</span></span><br><span class="line">res.raise_for_status()</span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line">soup=bs4.BeautifulSoup(res.text, <span class="string">"html.parser"</span>)</span><br><span class="line"></span><br><span class="line">linkElems = soup.select(<span class="string">'.r a'</span>)</span><br><span class="line"></span><br><span class="line">numOpen=min(<span class="number">5</span>,len(linkElems))</span><br><span class="line"></span><br><span class="line">webbrowser.open(<span class="string">'http://google.com/search?q='</span>+<span class="string">'+'</span>.join(sys.argv[<span class="number">1</span>:]))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(numOpen):</span><br><span class="line">    webbrowser.open(<span class="string">'http://google.com'</span>+linkElems[i].get(<span class="string">'href'</span>))</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/undefined  tle/" itemprop="url">Life Hacks:Manga Downloader</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-27T21:55:18+09:00">
                2018-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>You love Mangas. You are searching for a way to read them offline. Congratulations, You just found a way.</p>
<p>We import the following packages</p>
<ol>
<li><em>requests</em> - It gives us some of the functionality of the browser</li>
<li><em>os</em> - It lets us organize files</li>
<li><em>bs4</em> - It would help us search the required HTML tag</li>
</ol>
<p>Steps:</p>
<ol>
<li>We make a folder using <em>os</em></li>
<li>We use <em>request</em> to download the page</li>
<li>We use <em>bs4</em> to find the URL of imageFile</li>
<li>We download the image using <em>requests</em> and write it</li>
<li>We use bs4 to find next or previous image link and change URL accordingly.</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.makedirs(<span class="string">'xkcd'</span>,exist_ok=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p>We make a new folder. If it already exists, no new folder is made.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res=requests.get(url)</span><br><span class="line">res.raise_for_status()</span><br></pre></td></tr></table></figure>
<p>We use requests to download the page.Second line stops executing program in the case of an error.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">soup=bs4.BeautifulSoup(res.text, <span class="string">"html.parser"</span>)</span><br><span class="line">comicElem=soup.select(<span class="string">'#comic img'</span>)</span><br><span class="line"><span class="keyword">if</span>(comicElem==[]):</span><br><span class="line">    print(<span class="string">"Couldn't find comic image"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    comicURL=<span class="string">'http:'</span>+comicElem[<span class="number">0</span>].get(<span class="string">'src'</span>)</span><br></pre></td></tr></table></figure>
<p>We find Image URL</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">imageFile=open(os.path.join(<span class="string">'xkcd'</span>,comicElem[<span class="number">0</span>].get(<span class="string">'alt'</span>)),<span class="string">'wb'</span>)</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> res.iter_content(<span class="number">100000</span>):</span><br><span class="line">    imageFile.write(chunk)</span><br><span class="line">imageFile.close()</span><br></pre></td></tr></table></figure>
<p>We save the image to the suitable folder path. We use <em>os.path.join</em> to get that path. Then we write the image.</p>
<p>The entire program for reference.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,os,bs4</span><br><span class="line"></span><br><span class="line">url=<span class="string">'http://xkcd.com'</span></span><br><span class="line">os.makedirs(<span class="string">'xkcd'</span>,exist_ok=<span class="keyword">True</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> url.endswith(<span class="string">'#'</span>):</span><br><span class="line">    print(<span class="string">'Download the page %s.....'</span>%(url))</span><br><span class="line">    res=requests.get(url)</span><br><span class="line">    res.raise_for_status()</span><br><span class="line"></span><br><span class="line">    soup=bs4.BeautifulSoup(res.text, <span class="string">"html.parser"</span>)</span><br><span class="line">    comicElem=soup.select(<span class="string">'#comic img'</span>)</span><br><span class="line">    <span class="keyword">if</span>(comicElem==[]):</span><br><span class="line">        print(<span class="string">"Couldn't find comic image"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        comicURL=<span class="string">'http:'</span>+comicElem[<span class="number">0</span>].get(<span class="string">'src'</span>)</span><br><span class="line">        print(<span class="string">'Downloading %s image %s...'</span> %(comicElem[<span class="number">0</span>].get(<span class="string">'alt'</span>),comicURL))</span><br><span class="line">        res=requests.get(comicURL)</span><br><span class="line">        res.raise_for_status()</span><br><span class="line">    imageFile=open(os.path.join(<span class="string">'xkcd'</span>,comicElem[<span class="number">0</span>].get(<span class="string">'alt'</span>)),<span class="string">'wb'</span>)</span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> res.iter_content(<span class="number">100000</span>):</span><br><span class="line">        imageFile.write(chunk)</span><br><span class="line">    imageFile.close()</span><br><span class="line"></span><br><span class="line">    prevLink=soup.select(<span class="string">'a[rel="prev"]'</span>)[<span class="number">0</span>]</span><br><span class="line">    url=<span class="string">'http://xkcd.com'</span>+prevLink.get(<span class="string">'href'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'Download complete'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/undefined  tle/" itemprop="url">Life Hacks:Phone/Email Extractor</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-27T21:24:52+09:00">
                2018-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>You are working for a company and you are asked to find the Phone Number and Email address from a long Excel file. You start scrolling the document which goes on endlessly. You know you will have to do lots of overtime to finish the work. You look at the phone to see your son’s photo. You won’t be spending family time due to the Workload. But, Suddenly you have an idea.</p>
<p>Python makes it really easy to do this task using Regular Expressions. We are going to try to use Regular Expression.<br><em>Note: Reproducibility is the most important thing kept in mind while writing the program.</em></p>
<p>We import the following packages</p>
<ol>
<li><em>re</em> - Regular Expression Package</li>
<li><em>pyperclip</em> - It lets us work with clipboard</li>
</ol>
<p>Steps:</p>
<ol>
<li>Write Regular Expression syntax</li>
<li>Paste the text using pyperclip</li>
<li>Print the matched result</li>
</ol>
<p>Regular Expression are very useful but they are not without their own downsides. It is important to set the syntax of ReX(Regular Expression) right or the whole thing would go wrong.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">phoneRegex = re.compile(<span class="string">r'''(</span></span><br><span class="line"><span class="string">(\d&#123;3&#125;|\(\d&#123;3&#125;\))        #Area Code</span></span><br><span class="line"><span class="string">(\s|-|\.)                #Separator</span></span><br><span class="line"><span class="string">(\d&#123;4&#125;|\d&#123;3&#125;)            #middle 3 or 4 digits</span></span><br><span class="line"><span class="string">(\s|-|\.)                #Separator</span></span><br><span class="line"><span class="string">(\d&#123;4&#125;)                  #Last 4 digits</span></span><br><span class="line"><span class="string">)'''</span>,re.X)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">emailRegex=re.compile(<span class="string">r'''(</span></span><br><span class="line"><span class="string">[a-zA-Z0-9.+_%-]+            #Username</span></span><br><span class="line"><span class="string">@                            #@symbol</span></span><br><span class="line"><span class="string">[a-zA-Z0-9.-]+               #domain name</span></span><br><span class="line"><span class="string">(\.[a-zA-Z]&#123;2,4&#125;)            #dot something(most likely com)</span></span><br><span class="line"><span class="string">)'''</span>,re.X)</span><br></pre></td></tr></table></figure>
<p>Next step can be modified in several ways. The most general way would be to copy the text and use pyperclip to access the clipboard.</p>
<p>Final step would be to print the result in desired way.</p>
<p><strong>Thoughts</strong> : I definitely think it would be useful to me. I can modify it and make my web crawler. i can think of many scenario where it would be useful.</p>
<p>The whole program is written below for reference.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Phone number and email extractor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pyperclip,re</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pyperclip is used to paste the contents in the clipboard</span></span><br><span class="line"><span class="comment"># print(pyperclip.paste())</span></span><br><span class="line"></span><br><span class="line">phoneRegex = re.compile(<span class="string">r'''(</span></span><br><span class="line"><span class="string">(\d&#123;3&#125;|\(\d&#123;3&#125;\))        #Area Code</span></span><br><span class="line"><span class="string">(\s|-|\.)                #Separator</span></span><br><span class="line"><span class="string">(\d&#123;4&#125;|\d&#123;3&#125;)            #middle 3 or 4 digits</span></span><br><span class="line"><span class="string">(\s|-|\.)                #Separator</span></span><br><span class="line"><span class="string">(\d&#123;4&#125;)                  #Last 4 digits</span></span><br><span class="line"><span class="string">)'''</span>,re.X)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(phoneRegex.findall("easfgd 435-324-4323 anf 535-2452-3424 "))</span></span><br><span class="line"></span><br><span class="line">emailRegex=re.compile(<span class="string">r'''(</span></span><br><span class="line"><span class="string">[a-zA-Z0-9.+_%-]+            #Username</span></span><br><span class="line"><span class="string">@                            #@symbol</span></span><br><span class="line"><span class="string">[a-zA-Z0-9.-]+               #domain name</span></span><br><span class="line"><span class="string">(\.[a-zA-Z]&#123;2,4&#125;)            #dot something(most likely com)</span></span><br><span class="line"><span class="string">)'''</span>,re.X)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(emailRegex.findall("email is fdsdgr@gmai.com"))</span></span><br><span class="line"></span><br><span class="line">text=str(pyperclip.paste())</span><br><span class="line">matches=[]</span><br><span class="line"><span class="keyword">for</span> groups <span class="keyword">in</span> phoneRegex.findall(text):</span><br><span class="line">   phoneNum=<span class="string">'-'</span>.join([groups[<span class="number">1</span>],groups[<span class="number">3</span>],groups[<span class="number">5</span>]])</span><br><span class="line">   matches.append(<span class="string">'Phone numbers'</span>)</span><br><span class="line">   matches.append(phoneNum)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> groups <span class="keyword">in</span> emailRegex.findall(text):</span><br><span class="line">   matches.append(<span class="string">"Emails"</span>)</span><br><span class="line">   matches.append(groups[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> match <span class="keyword">in</span> matches:</span><br><span class="line">   print(match)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/undefined  tle/" itemprop="url">LIFE HACKS: The End</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T13:43:52+09:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>There are lot of tasks which can be automated using programming. Work which usually takes hours, if not days, can be done in minutes. Life Hacks explores some of those tasks and tries to automate them.</p>
<p>Every program is written in such a way that it easily be modified to do a wide range of applications. This is extremely important. The reason being writing a new program for a different task(which is usually the case) takes a long time.</p>
<p>Please contact me by email if there are any bugs.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/undefined  tle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sahil Bansal">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/undefined  tle/" itemprop="url">Blog 0: The Start</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-16T09:36:21+09:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>It has begun !!</p>
<p>Machines have begun their invasion on mankind. It was foolish for us to ever think that we could control them, for we are just Humans.</p>
<p>In 1940s first Atom Bomb was tested. A scientist was heard saying “We have now obtained the power of Gods.”. We all were proud and terrified at the same time. We were proud that we were becoming stronger. We were terrified because we were not wise enough to become that strong. We deviated from the path set out for us by the Gods. We were delighted as were now able to choose a path by our free will. But that was not the only feeling. As we looked, all the paths were much more dangerous than the current one.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Sahil Bansal</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sahil Bansal</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
